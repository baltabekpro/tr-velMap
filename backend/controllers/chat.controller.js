/**
 * ========================================
 * –ö–û–ù–¢–†–û–õ–õ–ï–† –ß–ê–¢–ë–û–¢–ê / CHAT CONTROLLER
 * ========================================
 */

// –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π —á–∞—Ç–±–æ—Ç–∞
const chatbotKnowledge = {
    // –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è
    greetings: {
        patterns: ['—Å”ô–ª–µ–º', '–ø—Ä–∏–≤–µ—Ç', 'hello', 'hi', '“õ–æ—à –∫–µ–ª–¥—ñ“£—ñ–∑', '–¥–æ–±—Ä—ã–π –¥–µ–Ω—å', '—Å–∞–ª–∞–º'],
        responses: [
            {
                kk: "–°”ô–ª–µ–º! üëã –ú–µ–Ω —Å—ñ–∑–¥—ñ“£ –≤–∏—Ä—Ç—É–∞–ª–¥—ã –≥–∏–¥—ñ“£—ñ–∑–±—ñ–Ω. –ê–ª–º–∞—Ç—ã —Ç—É—Ä–∞–ª—ã –Ω–µ –±—ñ–ª–≥—ñ“£—ñ–∑ –∫–µ–ª–µ–¥—ñ?",
                ru: "–ü—Ä–∏–≤–µ—Ç! üëã –Ø –≤–∞—à –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –≥–∏–¥. –ß—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–∑–Ω–∞—Ç—å –æ–± –ê–ª–º–∞—Ç—ã?",
                en: "Hello! üëã I'm your virtual guide. What would you like to know about Almaty?"
            }
        ]
    },
    
    // –ú–µ–¥–µ—É
    medeu: {
        patterns: ['–º–µ–¥–µ—É', '–º–µ–¥–µ–æ', 'medeu', '–∫–∞—Ç–æ–∫', '–º“±–∑ –∞–π–¥—ã–Ω—ã', '–∫–æ–Ω—å–∫–∏'],
        responses: [
            {
                kk: "‚õ∑Ô∏è –ú–µ–¥–µ—É - ”ô–ª–µ–º–¥–µ–≥—ñ –µ“£ –±–∏—ñ–∫ –º“±–∑ –∞–π–¥—ã–Ω—ã (1691–º)! –¢–∞–º–∞—à–∞ –∫”©—Ä—ñ–Ω—ñ—Å –∂”ô–Ω–µ —Å–ø–æ—Ä—Ç –æ—Ä–Ω—ã.\n\nüìç –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: 43.157¬∞N, 77.059¬∞E\n‚è∞ –ñ“±–º—ã—Å —É–∞“õ—ã—Ç—ã: 09:00-21:00\nüí∞ –ö—ñ—Ä—É: 2000-5000‚Ç∏\nüöå –ñ–µ—Ç—É: ‚Ññ6 –∞–≤—Ç–æ–±—É—Å –Ω–µ–º–µ—Å–µ —Ç–∞–∫—Å–∏\n\n“ö–∞—Ä—Ç–∞ –∞—à–∞–π—ã–Ω –±–∞?",
                ru: "‚õ∑Ô∏è –ú–µ–¥–µ–æ - –≤—ã—Å–æ–∫–æ–≥–æ—Ä–Ω—ã–π –∫–∞—Ç–æ–∫ –º–∏—Ä–æ–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è (1691–º)! –ü–æ—Ç—Ä—è—Å–∞—é—â–∏–µ –≤–∏–¥—ã –∏ —Å–ø–æ—Ä—Ç.\n\nüìç –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: 43.157¬∞N, 77.059¬∞E\n‚è∞ –†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã: 09:00-21:00\nüí∞ –í—Ö–æ–¥: 2000-5000‚Ç∏\nüöå –ö–∞–∫ –¥–æ–±—Ä–∞—Ç—å—Å—è: –∞–≤—Ç–æ–±—É—Å ‚Ññ6 –∏–ª–∏ —Ç–∞–∫—Å–∏\n\n–ü–æ–∫–∞–∑–∞—Ç—å –Ω–∞ –∫–∞—Ä—Ç–µ?",
                en: "‚õ∑Ô∏è Medeu - world-class high-altitude ice rink (1691m)! Amazing views and sports.\n\nüìç Coordinates: 43.157¬∞N, 77.059¬∞E\n‚è∞ Hours: 09:00-21:00\nüí∞ Entry: 2000-5000‚Ç∏\nüöå How to get: bus #6 or taxi\n\nShow on map?"
            }
        ],
        placeId: 1
    },
    
    // –ö–æ–∫-–¢–æ–±–µ
    koktobe: {
        patterns: ['–∫”©–∫—Ç”©–±–µ', '–∫–æ–∫-—Ç–æ–±–µ', 'koktobe', 'kok-tobe', '–∞—Å–ø–∞–ª—ã –∂–æ–ª', '–∫–∞–Ω–∞—Ç–Ω–∞—è –¥–æ—Ä–æ–≥–∞', '–≥–æ—Ä–∞'],
        responses: [
            {
                kk: "üé° –ö”©–∫—Ç”©–±–µ - –ê–ª–º–∞—Ç—ã–Ω—ã“£ —Å–∏–º–≤–æ–ª—ã! –ê—Å–ø–∞–ª—ã –∂–æ–ª–º–µ–Ω –∫”©—Ç–µ—Ä—ñ–ª—ñ–ø, “õ–∞–ª–∞–Ω—ã“£ –∫–µ—Ä–µ–º–µ—Ç –∫”©—Ä—ñ–Ω—ñ—Å—ñ–Ω —Ç–∞–º–∞—à–∞–ª–∞“£—ã–∑.\n\nüìç –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: 43.232¬∞N, 76.956¬∞E\n‚è∞ –ñ“±–º—ã—Å —É–∞“õ—ã—Ç—ã: 10:00-23:00\nüí∞ –ö—ñ—Ä—É: 1000-3000‚Ç∏\nüö° –ê—Å–ø–∞–ª—ã –∂–æ–ª –±–∞—Ä\n\n–¢–æ–ª—ã“ì—ã—Ä–∞“õ –∫”©—Ä—Å–µ—Ç–µ–π—ñ–Ω –±–µ?",
                ru: "üé° –ö–æ–∫-–¢–æ–±–µ - —Å–∏–º–≤–æ–ª –ê–ª–º–∞—Ç—ã! –ü–æ–¥–Ω–∏–º–∏—Ç–µ—Å—å –Ω–∞ –∫–∞–Ω–∞—Ç–Ω–æ–π –¥–æ—Ä–æ–≥–µ –∏ –Ω–∞—Å–ª–∞–¥–∏—Ç–µ—Å—å –≤–∏–¥–æ–º –Ω–∞ –≥–æ—Ä–æ–¥.\n\nüìç –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: 43.232¬∞N, 76.956¬∞E\n‚è∞ –†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã: 10:00-23:00\nüí∞ –í—Ö–æ–¥: 1000-3000‚Ç∏\nüö° –ö–∞–Ω–∞—Ç–Ω–∞—è –¥–æ—Ä–æ–≥–∞\n\n–ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–µ–µ?",
                en: "üé° Kok-Tobe - symbol of Almaty! Take the cable car and enjoy the city view.\n\nüìç Coordinates: 43.232¬∞N, 76.956¬∞E\n‚è∞ Hours: 10:00-23:00\nüí∞ Entry: 1000-3000‚Ç∏\nüö° Cable car available\n\nShow more details?"
            }
        ],
        placeId: 2
    },
    
    // –ë–ê–û (–ë–æ–ª—å—à–æ–µ –ê–ª–º–∞—Ç–∏–Ω—Å–∫–æ–µ –æ–∑–µ—Ä–æ)
    bao: {
        patterns: ['–±–∞–æ', '“Ø–ª–∫–µ–Ω –∞–ª–º–∞—Ç—ã –∫”©–ª—ñ', '–±–æ–ª—å—à–æ–µ –∞–ª–º–∞—Ç–∏–Ω—Å–∫–æ–µ –æ–∑–µ—Ä–æ', '–æ–∑–µ—Ä–æ', 'big almaty lake', '–∫”©–ª'],
        responses: [
            {
                kk: "üèîÔ∏è –ë–ê–û - —Ç–∞—É–ª–∞—Ä–¥–∞“ì—ã –∫”©–≥—ñ–ª–¥—ñ—Ä –∞—Å—ã–ª —Ç–∞—Å! 2511 –º–µ—Ç—Ä –±–∏—ñ–∫—Ç—ñ–∫—Ç–µ –æ—Ä–Ω–∞–ª–∞—Å“õ–∞–Ω –∫–µ—Ä–µ–º–µ—Ç —Ç–∞–±–∏“ì–∏ –∫”©–ª.\n\nüìç –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: 43.055¬∞N, 76.989¬∞E\n‚è∞ “ö–æ–ª–∂–µ—Ç—ñ–º–¥—ñ: 24/7\nüí∞ –¢–µ–≥—ñ–Ω\nüöó –ñ–µ—Ç—É: —Ç–∞–∫—Å–∏ –Ω–µ–º–µ—Å–µ –∂–µ–∫–µ –∫”©–ª—ñ–∫\n\n–ë“±–ª –∂–µ—Ä–≥–µ —Å–∞—è—Ö–∞—Ç –∫–µ—Ä–µ–º–µ—Ç!",
                ru: "üèîÔ∏è –ë–ê–û - –≥–æ–ª—É–±–∞—è –∂–µ–º—á—É–∂–∏–Ω–∞ –≥–æ—Ä! –£–¥–∏–≤–∏—Ç–µ–ª—å–Ω–æ–µ –ø—Ä–∏—Ä–æ–¥–Ω–æ–µ –æ–∑–µ—Ä–æ –Ω–∞ –≤—ã—Å–æ—Ç–µ 2511 –º–µ—Ç—Ä–æ–≤.\n\nüìç –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: 43.055¬∞N, 76.989¬∞E\n‚è∞ –î–æ—Å—Ç—É–ø–Ω–æ: 24/7\nüí∞ –ë–µ—Å–ø–ª–∞—Ç–Ω–æ\nüöó –ö–∞–∫ –¥–æ–±—Ä–∞—Ç—å—Å—è: —Ç–∞–∫—Å–∏ –∏–ª–∏ –ª–∏—á–Ω—ã–π –∞–≤—Ç–æ–º–æ–±–∏–ª—å\n\n–≠—Ç–æ –º–µ—Å—Ç–æ –≤–æ—Å—Ö–∏—Ç–∏—Ç–µ–ª—å–Ω–æ!",
                en: "üèîÔ∏è BAO - blue pearl of the mountains! Amazing natural lake at 2511 meters altitude.\n\nüìç Coordinates: 43.055¬∞N, 76.989¬∞E\n‚è∞ Available: 24/7\nüí∞ Free\nüöó How to get: taxi or private car\n\nThis place is stunning!"
            }
        ],
        placeId: 3
    },
    
    // –®—ã–º–±—É–ª–∞–∫
    shymbulak: {
        patterns: ['—à—ã–º–±“±–ª–∞“õ', '—à—ã–º–±—É–ª–∞–∫', 'shymbulak', '—Ç–∞—É-—à–∞“£“ì—ã', '–≥–æ—Ä–Ω–æ–ª—ã–∂–Ω—ã–π', 'ski', '–ª—ã–∂–∏'],
        responses: [
            {
                kk: "‚õ∑Ô∏è –®—ã–º–±“±–ª–∞“õ - —Ç–∞—É-—à–∞“£“ì—ã –∫—É—Ä–æ—Ä—Ç—ã! “ö—ã—Å—Ç–∞ —à–∞“£“ì—ã —Ç–µ–±—É, –∂–∞–∑–¥–∞ —Å–µ—Ä—É–µ–Ω–¥–µ—É.\n\nüìç –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: 43.237¬∞N, 77.083¬∞E\n‚è∞ –ñ“±–º—ã—Å —É–∞“õ—ã—Ç—ã: 09:00-17:00\nüí∞ –ö—ñ—Ä—É: 5000-15000‚Ç∏\nüö° –ú–µ–¥–µ—É –∞—Ä“õ—ã–ª—ã –≥–æ–Ω–¥–æ–ª\n\n“ö—ã—Å—ã –º–µ–Ω –∂–∞–∑—ã —Ç–∞–º–∞—à–∞!",
                ru: "‚õ∑Ô∏è –®—ã–º–±—É–ª–∞–∫ - –≥–æ—Ä–Ω–æ–ª—ã–∂–Ω—ã–π –∫—É—Ä–æ—Ä—Ç! –ó–∏–º–æ–π –∫–∞—Ç–∞–Ω–∏–µ –Ω–∞ –ª—ã–∂–∞—Ö, –ª–µ—Ç–æ–º –ø–µ—à–∏–µ –ø—Ä–æ–≥—É–ª–∫–∏.\n\nüìç –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: 43.237¬∞N, 77.083¬∞E\n‚è∞ –†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã: 09:00-17:00\nüí∞ –í—Ö–æ–¥: 5000-15000‚Ç∏\nüö° –ì–æ–Ω–¥–æ–ª–∞ —á–µ—Ä–µ–∑ –ú–µ–¥–µ–æ\n\n–û—Ç–ª–∏—á–Ω–æ –∑–∏–º–æ–π –∏ –ª–µ—Ç–æ–º!",
                en: "‚õ∑Ô∏è Shymbulak - ski resort! Winter skiing, summer hiking.\n\nüìç Coordinates: 43.237¬∞N, 77.083¬∞E\n‚è∞ Hours: 09:00-17:00\nüí∞ Entry: 5000-15000‚Ç∏\nüö° Gondola via Medeu\n\nGreat in winter and summer!"
            }
        ],
        placeId: 4
    },
    
    // –ü–∞—Ä–∫
    park: {
        patterns: ['–ø–∞—Ä–∫', '–±—ñ—Ä—ñ–Ω—à—ñ –ø—Ä–µ–∑–∏–¥–µ–Ω—Ç', '–ø–µ—Ä–≤–æ–≥–æ –ø—Ä–µ–∑–∏–¥–µ–Ω—Ç–∞', 'park', '–¥–µ–º–∞–ª—É', '–æ—Ç–¥—ã—Ö'],
        responses: [
            {
                kk: "üå≥ –ë—ñ—Ä—ñ–Ω—à—ñ –ü—Ä–µ–∑–∏–¥–µ–Ω—Ç –ø–∞—Ä–∫—ñ - “õ–∞–ª–∞ –æ—Ä—Ç–∞–ª—ã“ì—ã–Ω–¥–∞“ì—ã “Ø–ª–∫–µ–Ω –¥–µ–º–∞–ª—ã—Å –ø–∞—Ä–∫—ñ.\n\nüìç –ú–µ—Ç—Ä–æ: –ê–±–∞–π —Å—Ç–∞–Ω—Ü–∏—è—Å—ã\n‚è∞ –ñ“±–º—ã—Å —É–∞“õ—ã—Ç—ã: 06:00-23:00\nüí∞ –¢–µ–≥—ñ–Ω\n\n–û—Ç–±–∞—Å—ã–º–µ–Ω –¥–µ–º–∞–ª—É“ì–∞ –∫–µ—Ä–µ–º–µ—Ç –æ—Ä—ã–Ω!",
                ru: "üå≥ –ü–∞—Ä–∫ –ü–µ—Ä–≤–æ–≥–æ –ü—Ä–µ–∑–∏–¥–µ–Ω—Ç–∞ - –±–æ–ª—å—à–æ–π –ø–∞—Ä–∫ –æ—Ç–¥—ã—Ö–∞ –≤ —Ü–µ–Ω—Ç—Ä–µ –≥–æ—Ä–æ–¥–∞.\n\nüìç –ú–µ—Ç—Ä–æ: —Å—Ç–∞–Ω—Ü–∏—è –ê–±–∞–π\n‚è∞ –†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã: 06:00-23:00\nüí∞ –ë–µ—Å–ø–ª–∞—Ç–Ω–æ\n\n–û—Ç–ª–∏—á–Ω–æ –¥–ª—è –æ—Ç–¥—ã—Ö–∞ —Å —Å–µ–º—å—ë–π!",
                en: "üå≥ First President Park - large recreation park in city center.\n\nüìç Metro: Abai station\n‚è∞ Hours: 06:00-23:00\nüí∞ Free\n\nGreat for family recreation!"
            }
        ],
        placeId: 5
    },
    
    // –¢–æ—Ä–≥–æ–≤—ã–µ —Ü–µ–Ω—Ç—Ä—ã
    mall: {
        patterns: ['–º–æ–ª–ª', '–µ—Å–µ–Ω—Ç–∞–π', 'esentai', '—Å–∞—É–¥–∞ –æ—Ä—Ç–∞–ª—ã“ì—ã', '—Ç–æ—Ä–≥–æ–≤—ã–π —Ü–µ–Ω—Ç—Ä', 'mall', '–º–∞–≥–∞–∑–∏–Ω'],
        responses: [
            {
                kk: "üõçÔ∏è Esentai Mall - “õ–∞–ª–∞–Ω—ã“£ –µ“£ “Ø–ª–∫–µ–Ω —Å–∞—É–¥–∞ –æ—Ä—Ç–∞–ª—ã“ì—ã.\n\n‚è∞ –ñ“±–º—ã—Å —É–∞“õ—ã—Ç—ã: 10:00-22:00\nüí∞ –ö—ñ—Ä—É —Ç–µ–≥—ñ–Ω\nüöå –ë–∞—Ä–ª—ã“õ “õ–æ“ì–∞–º–¥—ã“õ –∫”©–ª—ñ–∫\n\n–î“Ø–∫–µ–Ω–¥–µ—Ä, —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã, –∫–∏–Ω–æ—Ç–µ–∞—Ç—Ä –±–∞—Ä!",
                ru: "üõçÔ∏è Esentai Mall - –∫—Ä—É–ø–Ω–µ–π—à–∏–π —Ç–æ—Ä–≥–æ–≤—ã–π —Ü–µ–Ω—Ç—Ä –≥–æ—Ä–æ–¥–∞.\n\n‚è∞ –†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã: 10:00-22:00\nüí∞ –í—Ö–æ–¥ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π\nüöå –í—Å–µ –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã\n\n–ï—Å—Ç—å –º–∞–≥–∞–∑–∏–Ω—ã, —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã, –∫–∏–Ω–æ—Ç–µ–∞—Ç—Ä!",
                en: "üõçÔ∏è Esentai Mall - largest shopping center in the city.\n\n‚è∞ Hours: 10:00-22:00\nüí∞ Free entry\nüöå All public transport\n\nHas shops, restaurants, cinema!"
            }
        ],
        placeId: 6
    },
    
    // –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
    recommendations: {
        patterns: ['“õ–∞–π–¥–∞', '–∫—É–¥–∞', 'where', '–∫–µ“£–µ—Å', '—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è', 'recommendation', '–ø–æ—Å–æ–≤–µ—Ç—É–π', '–Ω–µ –±—ñ–ª–≥—ñ“£—ñ–∑'],
        responses: [
            {
                kk: "üåü –ú–µ–Ω—ñ“£ –∫–µ“£–µ—Å—ñ–º:\n\n1Ô∏è‚É£ –¢–∞–±–∏“ì–∞—Ç—Ç—ã –∂–∞“õ—Å—ã –∫”©—Ä—Å–µ“£—ñ–∑ - –ë–ê–û –Ω–µ–º–µ—Å–µ –®—ã–º–±“±–ª–∞“õ\n2Ô∏è‚É£ “ö–∞–ª–∞–Ω—ã“£ –∫”©—Ä—ñ–Ω—ñ—Å—ñ “Ø—à—ñ–Ω - –ö”©–∫—Ç”©–±–µ\n3Ô∏è‚É£ –°–ø–æ—Ä—Ç “Ø—à—ñ–Ω - –ú–µ–¥–µ—É\n4Ô∏è‚É£ –û—Ç–±–∞—Å—ã–º–µ–Ω –¥–µ–º–∞–ª—É “Ø—à—ñ–Ω - –ë—ñ—Ä—ñ–Ω—à—ñ –ü—Ä–µ–∑–∏–¥–µ–Ω—Ç –ø–∞—Ä–∫—ñ\n5Ô∏è‚É£ –°–∞—É–¥–∞ “Ø—à—ñ–Ω - Esentai Mall\n\n“ö–∞–π —Å–∞–Ω–∞—Ç “õ—ã–∑—ã“õ—Ç—ã—Ä–∞–¥—ã?",
                ru: "üåü –ú–æ–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:\n\n1Ô∏è‚É£ –î–ª—è –ª—é–±–∏—Ç–µ–ª–µ–π –ø—Ä–∏—Ä–æ–¥—ã - –ë–ê–û –∏–ª–∏ –®—ã–º–±—É–ª–∞–∫\n2Ô∏è‚É£ –î–ª—è –≥–æ—Ä–æ–¥—Å–∫–∏—Ö –≤–∏–¥–æ–≤ - –ö–æ–∫-–¢–æ–±–µ\n3Ô∏è‚É£ –î–ª—è —Å–ø–æ—Ä—Ç–∞ - –ú–µ–¥–µ–æ\n4Ô∏è‚É£ –î–ª—è —Å–µ–º–µ–π–Ω–æ–≥–æ –æ—Ç–¥—ã—Ö–∞ - –ü–∞—Ä–∫ –ü–µ—Ä–≤–æ–≥–æ –ü—Ä–µ–∑–∏–¥–µ–Ω—Ç–∞\n5Ô∏è‚É£ –î–ª—è —à–æ–ø–∏–Ω–≥–∞ - Esentai Mall\n\n–ö–∞–∫–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç?",
                en: "üåü My recommendations:\n\n1Ô∏è‚É£ For nature lovers - BAO or Shymbulak\n2Ô∏è‚É£ For city views - Kok-Tobe\n3Ô∏è‚É£ For sports - Medeu\n4Ô∏è‚É£ For family recreation - First President Park\n5Ô∏è‚É£ For shopping - Esentai Mall\n\nWhich category interests you?"
            }
        ]
    },
    
    // –ü–æ–≥–æ–¥–∞
    weather: {
        patterns: ['–∞—É–∞ —Ä–∞–π—ã', '–ø–æ–≥–æ–¥–∞', 'weather', '—Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞', '–∂–∞“£–±—ã—Ä', '–¥–æ–∂–¥—å'],
        responses: [
            {
                kk: "‚òÄÔ∏è –ê—É–∞ —Ä–∞–π—ã–Ω —Ç–µ–∫—Å–µ—Ä—ñ–ø –∂–∞—Ç—ã—Ä–º—ã–Ω...\n\n–ù–µ–≥—ñ–∑–≥—ñ –±–µ—Ç—Ç—ñ“£ —Ç”©–º–µ–Ω–≥—ñ –∂–∞“ì—ã–Ω–∞–Ω “õ–∞–∑—ñ—Ä–≥—ñ –∞—É–∞ —Ä–∞–π—ã–Ω –∫”©—Ä–µ –∞–ª–∞—Å—ã–∑!",
                ru: "‚òÄÔ∏è –ü—Ä–æ–≤–µ—Ä—è—é –ø–æ–≥–æ–¥—É...\n\n–í—ã –º–æ–∂–µ—Ç–µ —É–≤–∏–¥–µ—Ç—å —Ç–µ–∫—É—â—É—é –ø–æ–≥–æ–¥—É –≤–Ω–∏–∑—É –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã!",
                en: "‚òÄÔ∏è Checking weather...\n\nYou can see current weather at the bottom of the main page!"
            }
        ],
        action: 'weather'
    },
    
    // –ö–∞–∫ –¥–æ–±—Ä–∞—Ç—å—Å—è
    howToGet: {
        patterns: ['“õ–∞–ª–∞–π –±–∞—Ä–∞–º—ã–Ω', '–∫–∞–∫ –¥–æ–±—Ä–∞—Ç—å—Å—è', 'how to get', '–∂–æ–ª', '–º–∞—Ä—à—Ä—É—Ç', 'route'],
        responses: [
            {
                kk: "üöå “ö–∞–π–¥–∞ –±–∞—Ä“ì—ã“£—ã–∑ –∫–µ–ª–µ–¥—ñ?\n\n–ú–µ–¥–µ—É, –ö”©–∫—Ç”©–±–µ, –ë–ê–û –Ω–µ–º–µ—Å–µ –±–∞—Å“õ–∞ –æ—Ä—ã–Ω —Ç—É—Ä–∞–ª—ã –∞–π—Ç—ã“£—ã–∑, –º–µ–Ω –∂–æ–ª–¥—ã —Ç“Ø—Å—ñ–Ω–¥—ñ—Ä–µ–º—ñ–Ω!",
                ru: "üöå –ö—É–¥–∞ —Ö–æ—Ç–∏—Ç–µ –ø–æ–ø–∞—Å—Ç—å?\n\n–°–∫–∞–∂–∏—Ç–µ –æ –ú–µ–¥–µ–æ, –ö–æ–∫-–¢–æ–±–µ, –ë–ê–û –∏–ª–∏ –¥—Ä—É–≥–æ–º –º–µ—Å—Ç–µ, –∏ —è —Ä–∞—Å—Å–∫–∞–∂—É –º–∞—Ä—à—Ä—É—Ç!",
                en: "üöå Where do you want to go?\n\nTell me about Medeu, Kok-Tobe, BAO or other place, and I'll explain the route!"
            }
        ]
    },
    
    // –ë–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å
    thanks: {
        patterns: ['—Ä–∞“õ–º–µ—Ç', '—Å–ø–∞—Å–∏–±–æ', 'thank', '—Å–∞—É –±–æ–ª', '–ø–æ–∫–∞', 'bye'],
        responses: [
            {
                kk: "“ö–æ—à –±–æ–ª—ã“£—ã–∑! üòä –ê–ª–º–∞—Ç—ã–¥–∞ –∂–∞“õ—Å—ã —Å–µ—Ä—É–µ–Ω–¥–µ“£—ñ–∑!",
                ru: "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞! üòä –•–æ—Ä–æ—à–µ–≥–æ –æ—Ç–¥—ã—Ö–∞ –≤ –ê–ª–º–∞—Ç—ã!",
                en: "You're welcome! üòä Enjoy Almaty!"
            }
        ]
    },
    
    // –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
    unknown: {
        responses: [
            {
                kk: "ü§î –ö–µ—à—ñ—Ä—ñ“£—ñ–∑, —Ç“Ø—Å—ñ–Ω–±–µ–¥—ñ–º. –°—ñ–∑ –º—ã–Ω–∞—É —Ç—É—Ä–∞–ª—ã —Å“±—Ä–∞–π –∞–ª–∞—Å—ã–∑:\n\n‚Ä¢ –ú–µ–¥–µ—É, –ö”©–∫—Ç”©–±–µ, –ë–ê–û, –®—ã–º–±“±–ª–∞“õ\n‚Ä¢ –ü–∞—Ä–∫—Ç–µ—Ä –º–µ–Ω –º–æ–ª–¥–∞—Ä\n‚Ä¢ –ê—É–∞ —Ä–∞–π—ã\n‚Ä¢ “ö–∞–ª–∞–π –±–∞—Ä–∞–º—ã–Ω?\n\n–ù–µ –±—ñ–ª–≥—ñ“£—ñ–∑ –∫–µ–ª–µ–¥—ñ?",
                ru: "ü§î –ò–∑–≤–∏–Ω–∏—Ç–µ, –Ω–µ –ø–æ–Ω—è–ª. –í—ã –º–æ–∂–µ—Ç–µ —Å–ø—Ä–æ—Å–∏—Ç—å –æ:\n\n‚Ä¢ –ú–µ–¥–µ–æ, –ö–æ–∫-–¢–æ–±–µ, –ë–ê–û, –®—ã–º–±—É–ª–∞–∫\n‚Ä¢ –ü–∞—Ä–∫–∏ –∏ –º–æ–ª–ª—ã\n‚Ä¢ –ü–æ–≥–æ–¥–∞\n‚Ä¢ –ö–∞–∫ –¥–æ–±—Ä–∞—Ç—å—Å—è?\n\n–ß—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–∑–Ω–∞—Ç—å?",
                en: "ü§î Sorry, I don't understand. You can ask about:\n\n‚Ä¢ Medeu, Kok-Tobe, BAO, Shymbulak\n‚Ä¢ Parks and malls\n‚Ä¢ Weather\n‚Ä¢ How to get there?\n\nWhat would you like to know?"
            }
        ]
    }
};

/**
 * –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —è–∑—ã–∫ —Å–æ–æ–±—â–µ–Ω–∏—è
 */
function detectLanguage(message) {
    const lowerMessage = message.toLowerCase();
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∫–∞–∑–∞—Ö—Å–∫–∏—Ö –±—É–∫–≤
    if (/[”ô—ñ“£“ì“Ø“±“õ”©“ª]/i.test(message)) {
        return 'kk';
    }
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä—É—Å—Å–∫–∏–µ —Å–ª–æ–≤–∞
    if (/–ø—Ä–∏–≤–µ—Ç|–∑–¥—Ä–∞–≤—Å—Ç–≤—É–π|—Å–ø–∞—Å–∏–±–æ|–ø–æ–≥–æ–¥–∞|–∫—É–¥–∞|–∫–∞–∫|–≥–¥–µ|—á—Ç–æ/.test(lowerMessage)) {
        return 'ru';
    }
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ —Å–ª–æ–≤–∞
    if (/hello|hi|weather|where|how|what|thank/.test(lowerMessage)) {
        return 'en';
    }
    
    return 'ru'; // –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Ä—É—Å—Å–∫–∏–π
}

/**
 * –ù–∞–π—Ç–∏ –ø–æ–¥—Ö–æ–¥—è—â–∏–π –æ—Ç–≤–µ—Ç
 */
function findResponse(message, userLang = null) {
    const lowerMessage = message.toLowerCase();
    const lang = userLang || detectLanguage(message);
    
    // –ü—Ä–æ—Ö–æ–¥–∏–º –ø–æ –≤—Å–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
    for (const [category, data] of Object.entries(chatbotKnowledge)) {
        if (data.patterns) {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
            for (const pattern of data.patterns) {
                if (lowerMessage.includes(pattern.toLowerCase())) {
                    const response = data.responses[0][lang] || data.responses[0]['ru'];
                    return {
                        message: response,
                        category: category,
                        placeId: data.placeId || null,
                        action: data.action || null,
                        language: lang
                    };
                }
            }
        }
    }
    
    // –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ - –≤–æ–∑–≤—Ä–∞—â–∞–µ–º unknown
    const unknownResponse = chatbotKnowledge.unknown.responses[0][lang] || chatbotKnowledge.unknown.responses[0]['ru'];
    return {
        message: unknownResponse,
        category: 'unknown',
        placeId: null,
        action: null,
        language: lang
    };
}

/**
 * POST /api/chat - –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –±–æ—Ç—É
 */
exports.sendMessage = (req, res) => {
    try {
        const { message, language } = req.body;
        
        if (!message) {
            return res.status(400).json({
                success: false,
                error: '–°–æ–æ–±—â–µ–Ω–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ'
            });
        }
        
        const lang = language || 'kk';
        const response = findResponse(message, lang);
        
        res.json({
            success: true,
            data: {
                userMessage: message,
                botResponse: response.message,
                category: response.category,
                placeId: response.placeId,
                action: response.action,
                language: response.language,
                timestamp: new Date().toISOString()
            }
        });
    } catch (error) {
        console.error('Error in chat:', error);
        res.status(500).json({
            success: false,
            error: '–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è'
        });
    }
};

/**
 * GET /api/chat/suggestions - –ü–æ–ª—É—á–∏—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫–∏
 */
exports.getSuggestions = (req, res) => {
    const { lang = 'ru' } = req.query;
    
    const suggestions = {
        kk: [
            "“ö–∞–π–¥–∞ –±–∞—Ä—É“ì–∞ –∫–µ“£–µ—Å –±–µ—Ä–µ—Å—ñ“£?",
            "–ú–µ–¥–µ—É–≥–µ “õ–∞–ª–∞–π –±–∞—Ä–∞–º—ã–Ω?",
            "–ê—É–∞ —Ä–∞–π—ã “õ–∞–Ω–¥–∞–π?",
            "–ö”©–∫—Ç”©–±–µ —Ç—É—Ä–∞–ª—ã –∞–π—Ç—ã–ø –±–µ—Ä",
            "–ë–ê–û-“ì–∞ “õ–∞–ª–∞–π –∂–µ—Ç—É–≥–µ –±–æ–ª–∞–¥—ã?"
        ],
        ru: [
            "–ö—É–¥–∞ –ø–æ—Å–æ–≤–µ—Ç—É–µ—à—å —Å—Ö–æ–¥–∏—Ç—å?",
            "–ö–∞–∫ –¥–æ–±—Ä–∞—Ç—å—Å—è –¥–æ –ú–µ–¥–µ–æ?",
            "–ö–∞–∫–∞—è —Å–µ–≥–æ–¥–Ω—è –ø–æ–≥–æ–¥–∞?",
            "–†–∞—Å—Å–∫–∞–∂–∏ –ø—Ä–æ –ö–æ–∫-–¢–æ–±–µ",
            "–ö–∞–∫ –ø–æ–ø–∞—Å—Ç—å –Ω–∞ –ë–ê–û?"
        ],
        en: [
            "Where do you recommend to go?",
            "How to get to Medeu?",
            "What's the weather today?",
            "Tell me about Kok-Tobe",
            "How to reach BAO?"
        ]
    };
    
    res.json({
        success: true,
        suggestions: suggestions[lang] || suggestions['ru']
    });
};
