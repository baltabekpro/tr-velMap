<!DOCTYPE html>
<html lang="kk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–µ—Ä–≤–∏—Å –º”ô–ª—ñ–º–µ—Ç—Ç–µ—Ä—ñ - TravelMap</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        .service-detail-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .service-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            padding: 30px;
            color: white;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .service-header h1 {
            margin: 0 0 10px 0;
            font-size: 2.5em;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .service-status {
            display: inline-block;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
            text-transform: uppercase;
        }

        .status-active {
            background: #10b981;
        }

        .status-inactive {
            background: #ef4444;
        }

        .service-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .info-item {
            background: rgba(255,255,255,0.2);
            padding: 15px;
            border-radius: 10px;
        }

        .info-item label {
            display: block;
            font-size: 0.85em;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .info-item span {
            font-size: 1.2em;
            font-weight: bold;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e5e7eb;
        }

        .tab {
            padding: 15px 30px;
            background: none;
            border: none;
            color: #6b7280;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .tab.active {
            color: #667eea;
            font-weight: bold;
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 2px;
            background: #667eea;
        }

        .tab:hover {
            color: #667eea;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.3s;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .metric-card h3 {
            margin: 0 0 15px 0;
            color: #6b7280;
            font-size: 0.9em;
            text-transform: uppercase;
        }

        .metric-value {
            font-size: 2.5em;
            font-weight: bold;
            color: #1f2937;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .metric-icon {
            font-size: 0.6em;
        }

        .logs-container {
            background: #1f2937;
            border-radius: 15px;
            padding: 20px;
            max-height: 500px;
            overflow-y: auto;
        }

        .log-entry {
            padding: 12px;
            margin-bottom: 8px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            display: flex;
            align-items: center;
            gap: 10px;
            animation: slideIn 0.3s;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .log-entry.info {
            background: rgba(59, 130, 246, 0.2);
            color: #93c5fd;
        }

        .log-entry.success {
            background: rgba(16, 185, 129, 0.2);
            color: #6ee7b7;
        }

        .log-entry.error {
            background: rgba(239, 68, 68, 0.2);
            color: #fca5a5;
        }

        .log-entry.warning {
            background: rgba(245, 158, 11, 0.2);
            color: #fcd34d;
        }

        .log-time {
            color: #9ca3af;
            font-size: 0.85em;
        }

        .config-form {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #374151;
            font-weight: 500;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
            transform: translateY(-2px);
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-success:hover {
            background: #059669;
            transform: translateY(-2px);
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .chart-container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .chart-placeholder {
            height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f9fafb;
            border-radius: 10px;
            color: #6b7280;
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <span class="logo">üó∫Ô∏è</span>
                <span class="brand-name">TravelMap</span>
            </div>
            <ul class="nav-menu">
                <li><a href="index.html">üè† –ë–∞—Å—Ç—ã –±–µ—Ç</a></li>
                <li><a href="monitor.html">üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥</a></li>
                <li><a href="profile.html">üë§ –ü—Ä–æ—Ñ–∏–ª—å</a></li>
                <li><a href="admin.html">‚öôÔ∏è –ê–¥–º–∏–Ω</a></li>
            </ul>
        </div>
    </nav>

    <div class="service-detail-container">
        <div class="service-header">
            <h1>
                <span id="serviceIcon">üîß</span>
                <span id="serviceName">–°–µ—Ä–≤–∏—Å</span>
                <span id="serviceStatusBadge" class="service-status status-inactive">–ë–µ–ª–≥—ñ—Å—ñ–∑</span>
            </h1>
            <div class="service-info">
                <div class="info-item">
                    <label>–ü–æ—Ä—Ç:</label>
                    <span id="servicePort">-</span>
                </div>
                <div class="info-item">
                    <label>Endpoint:</label>
                    <span id="serviceEndpoint">-</span>
                </div>
                <div class="info-item">
                    <label>–ñ“±–º—ã—Å —É–∞“õ—ã—Ç—ã:</label>
                    <span id="serviceUptime">-</span>
                </div>
                <div class="info-item">
                    <label>–°–æ“£“ì—ã –∂–∞“£–∞—Ä—Ç—É:</label>
                    <span id="lastUpdate">-</span>
                </div>
            </div>
            <div class="action-buttons">
                <button class="btn btn-success" id="startBtn" onclick="toggleService()">‚ñ∂Ô∏è –Ü—Å–∫–µ “õ–æ—Å—É</button>
                <button class="btn btn-danger" id="stopBtn" onclick="toggleService()">‚èπÔ∏è –¢–æ“õ—Ç–∞—Ç—É</button>
                <button class="btn btn-primary" onclick="refreshService()">üîÑ –ñ–∞“£–∞—Ä—Ç—É</button>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('overview')">üìä –®–æ–ª—É</button>
            <button class="tab" onclick="switchTab('logs')">üìù –õ–æ–≥—Ç–∞—Ä</button>
            <button class="tab" onclick="switchTab('metrics')">üìà –ú–µ—Ç—Ä–∏–∫–∞–ª–∞—Ä</button>
            <button class="tab" onclick="switchTab('config')">‚öôÔ∏è –ë–∞–ø—Ç–∞—É–ª–∞—Ä</button>
        </div>

        <div id="overviewTab" class="tab-content active">
            <div class="metrics-grid">
                <div class="metric-card">
                    <h3>CPU –ü–∞–π–¥–∞–ª–∞–Ω—É</h3>
                    <div class="metric-value">
                        <span id="cpuValue">0</span>%
                        <span class="metric-icon">üî•</span>
                    </div>
                </div>
                <div class="metric-card">
                    <h3>–ñ–∞–¥ (Memory)</h3>
                    <div class="metric-value">
                        <span id="memoryValue">0</span> MB
                        <span class="metric-icon">üíæ</span>
                    </div>
                </div>
                <div class="metric-card">
                    <h3>–°“±—Ä–∞–Ω—ã—Å—Ç–∞—Ä</h3>
                    <div class="metric-value">
                        <span id="requestCount">0</span>
                        <span class="metric-icon">üì®</span>
                    </div>
                </div>
                <div class="metric-card">
                    <h3>–ñ–∞—É–∞–ø —É–∞“õ—ã—Ç—ã</h3>
                    <div class="metric-value">
                        <span id="responseTime">0</span> ms
                        <span class="metric-icon">‚ö°</span>
                    </div>
                </div>
            </div>

            <div class="chart-container">
                <h3>”®–Ω—ñ–º–¥—ñ–ª—ñ–∫ –≥—Ä–∞—Ñ–∏–≥—ñ</h3>
                <div class="chart-placeholder">
                    üìä –ì—Ä–∞—Ñ–∏–∫ –¥–µ—Ä–µ–∫—Ç–µ—Ä—ñ –∂“Ø–∫—Ç–µ–ª—É–¥–µ...
                </div>
            </div>
        </div>

        <div id="logsTab" class="tab-content">
            <div class="logs-container" id="logsContainer">
                <div class="log-entry info">
                    <span class="log-time">--:--:--</span>
                    <span>üìã –õ–æ–≥—Ç–∞—Ä –∂“Ø–∫—Ç–µ–ª—É–¥–µ...</span>
                </div>
            </div>
        </div>

        <div id="metricsTab" class="tab-content">
            <div class="chart-container">
                <h3>CPU –ñ“Ø–∫—Ç–µ–º–µ—Å—ñ</h3>
                <div class="chart-placeholder">
                    üìà CPU –º–µ—Ç—Ä–∏–∫–∞–ª–∞—Ä—ã
                </div>
            </div>
            <div class="chart-container">
                <h3>–ñ–∞–¥ –ø–∞–π–¥–∞–ª–∞–Ω—É—ã</h3>
                <div class="chart-placeholder">
                    üíæ –ñ–∞–¥ –º–µ—Ç—Ä–∏–∫–∞–ª–∞—Ä—ã
                </div>
            </div>
            <div class="chart-container">
                <h3>–°“±—Ä–∞–Ω—ã—Å—Ç–∞—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞—Å—ã</h3>
                <div class="chart-placeholder">
                    üìä –°“±—Ä–∞–Ω—ã—Å—Ç–∞—Ä –º–µ—Ç—Ä–∏–∫–∞–ª–∞—Ä—ã
                </div>
            </div>
        </div>

        <div id="configTab" class="tab-content">
            <div class="config-form">
                <h2>‚öôÔ∏è –°–µ—Ä–≤–∏—Å –±–∞–ø—Ç–∞—É–ª–∞—Ä—ã</h2>
                <div class="form-group">
                    <label>–ü–æ—Ä—Ç –Ω”©–º—ñ—Ä—ñ:</label>
                    <input type="number" id="configPort" placeholder="3001">
                </div>
                <div class="form-group">
                    <label>Endpoint:</label>
                    <input type="text" id="configEndpoint" placeholder="/api/service">
                </div>
                <div class="form-group">
                    <label>–ê–≤—Ç–æ–º–∞—Ç—Ç—ã —ñ—Å–∫–µ “õ–æ—Å—É:</label>
                    <select id="configAutostart">
                        <option value="true">–ò”ô</option>
                        <option value="false">–ñ–æ“õ</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>–õ–æ–≥ –¥–µ“£–≥–µ–π—ñ:</label>
                    <select id="configLogLevel">
                        <option value="debug">Debug</option>
                        <option value="info">Info</option>
                        <option value="warning">Warning</option>
                        <option value="error">Error</option>
                    </select>
                </div>
                <button class="btn btn-primary" onclick="saveConfig()">üíæ –°–∞“õ—Ç–∞—É</button>
            </div>
        </div>
    </div>

    <script src="js/monitoringService.js"></script>
    <script>
        let currentServiceId = null;

        // –ü–æ–ª—É—á–∞–µ–º ID —Å–µ—Ä–≤–∏—Å–∞ –∏–∑ URL
        function getServiceIdFromURL() {
            const params = new URLSearchParams(window.location.search);
            return params.get('service');
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–∞–±–æ–≤
        function switchTab(tabName) {
            // –î–µ–∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤—Å–µ —Ç–∞–±—ã
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –Ω—É–∂–Ω—ã–π —Ç–∞–±
            event.target.classList.add('active');
            document.getElementById(tabName + 'Tab').classList.add('active');
        }

        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ —Ä–∞–±–æ—Ç—ã
        function formatUptime(startTime) {
            if (!startTime) return '-';
            
            const now = Date.now();
            const diff = now - startTime;
            const hours = Math.floor(diff / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);
            
            return `${hours}—Å ${minutes}–º ${seconds}—Å`;
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–∞
        function loadServiceDetails() {
            currentServiceId = getServiceIdFromURL();
            
            if (!currentServiceId) {
                alert('–°–µ—Ä–≤–∏—Å —Ç–∞–±—ã–ª–º–∞–¥—ã!');
                window.location.href = 'monitor.html';
                return;
            }

            const service = servicesState[currentServiceId];
            const config = servicesConfig[currentServiceId];

            if (!service || !config) {
                alert('–°–µ—Ä–≤–∏—Å –¥–µ—Ä–µ–∫—Ç–µ—Ä—ñ —Ç–∞–±—ã–ª–º–∞–¥—ã!');
                window.location.href = 'monitor.html';
                return;
            }

            // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
            document.getElementById('serviceIcon').textContent = config.icon;
            document.getElementById('serviceName').textContent = config.name;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
            const statusBadge = document.getElementById('serviceStatusBadge');
            if (service.status === 'active') {
                statusBadge.textContent = '–ë–µ–ª—Å–µ–Ω–¥—ñ';
                statusBadge.className = 'service-status status-active';
            } else {
                statusBadge.textContent = '–ë–µ–ª—Å–µ–Ω–¥—ñ –µ–º–µ—Å';
                statusBadge.className = 'service-status status-inactive';
            }

            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
            document.getElementById('servicePort').textContent = config.port;
            document.getElementById('serviceEndpoint').textContent = config.endpoint;
            document.getElementById('serviceUptime').textContent = formatUptime(service.startTime);
            document.getElementById('lastUpdate').textContent = new Date().toLocaleTimeString('kk-KZ');

            // –û–±–Ω–æ–≤–ª—è–µ–º –º–µ—Ç—Ä–∏–∫–∏
            document.getElementById('cpuValue').textContent = service.cpu || 0;
            document.getElementById('memoryValue').textContent = service.memory || 0;
            document.getElementById('requestCount').textContent = service.requestCount || 0;
            document.getElementById('responseTime').textContent = service.responseTime || 0;

            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏
            const startBtn = document.getElementById('startBtn');
            const stopBtn = document.getElementById('stopBtn');
            
            if (service.status === 'active') {
                startBtn.style.display = 'none';
                stopBtn.style.display = 'inline-block';
            } else {
                startBtn.style.display = 'inline-block';
                stopBtn.style.display = 'none';
            }

            // –ó–∞–≥—Ä—É–∂–∞–µ–º –ª–æ–≥–∏
            loadLogs();

            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
            loadConfigForm();
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –ª–æ–≥–æ–≤
        function loadLogs() {
            const service = servicesState[currentServiceId];
            const logsContainer = document.getElementById('logsContainer');
            
            if (!service.logs || service.logs.length === 0) {
                logsContainer.innerHTML = `
                    <div class="log-entry info">
                        <span class="log-time">${new Date().toLocaleTimeString('kk-KZ')}</span>
                        <span>üìã –õ–æ–≥—Ç–∞—Ä –∂–æ“õ</span>
                    </div>
                `;
                return;
            }

            logsContainer.innerHTML = service.logs.map(log => {
                const typeClass = log.type || 'info';
                const icon = {
                    'info': '‚ÑπÔ∏è',
                    'success': '‚úÖ',
                    'error': '‚ùå',
                    'warning': '‚ö†Ô∏è'
                }[typeClass] || '‚ÑπÔ∏è';

                return `
                    <div class="log-entry ${typeClass}">
                        <span class="log-time">${log.time}</span>
                        <span>${icon} ${log.message}</span>
                    </div>
                `;
            }).join('');

            // –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –≤–Ω–∏–∑
            logsContainer.scrollTop = logsContainer.scrollHeight;
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ä–º—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
        function loadConfigForm() {
            const config = servicesConfig[currentServiceId];
            document.getElementById('configPort').value = config.port;
            document.getElementById('configEndpoint').value = config.endpoint;
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞
        function toggleService() {
            const service = servicesState[currentServiceId];
            
            if (service.status === 'active') {
                stopService(currentServiceId);
            } else {
                startService(currentServiceId);
            }
            
            setTimeout(() => {
                loadServiceDetails();
            }, 500);
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞
        function refreshService() {
            checkServiceHealth(currentServiceId);
            loadServiceDetails();
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
        function saveConfig() {
            const port = document.getElementById('configPort').value;
            const endpoint = document.getElementById('configEndpoint').value;
            
            servicesConfig[currentServiceId].port = parseInt(port);
            servicesConfig[currentServiceId].endpoint = endpoint;
            
            alert('‚úÖ –ë–∞–ø—Ç–∞—É–ª–∞—Ä —Å–∞“õ—Ç–∞–ª–¥—ã!');
            addServiceLog(currentServiceId, '‚öôÔ∏è –ë–∞–ø—Ç–∞—É–ª–∞—Ä –∂–∞“£–∞—Ä—Ç—ã–ª–¥—ã', 'info');
            loadServiceDetails();
        }

        // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
        setInterval(() => {
            if (currentServiceId) {
                checkServiceHealth(currentServiceId);
                loadServiceDetails();
            }
        }, 5000);

        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
        document.addEventListener('DOMContentLoaded', loadServiceDetails);
    </script>
</body>
</html>
